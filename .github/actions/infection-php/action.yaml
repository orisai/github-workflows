name: "Infection PHP"
description: "Run Infection PHP"

inputs:
  command:
    required: true
    description: "Infection command"

  cache-path:
    required: true
    description: "Infection cache path"

  stryker-token:
    required: false
    description: "Stryker token for submitting code coverage"

runs:
  using: "composite"

  steps:
    - name: "Cache Infection data"
      uses: "actions/cache@v2"
      with:
        path: "${{ inputs.cache-path }}"
        key: "ori-php-infection-${{ runner.os }}"
        restore-keys: "ori-php-infection-${{ runner.os }}"

    - name: "Mutation tests with report"
      if: "${{ inputs.stryker-token }}"
      env:
        STRYKER_DASHBOARD_API_KEY: "${{ inputs.stryker-token }}"
      shell: "bash"
      run: "${{ inputs.command }}"

    - name: "Mutation tests"
      if: "${{ !inputs.stryker-token }}"
      shell: "bash"
      run: "${{ inputs.command }}"
